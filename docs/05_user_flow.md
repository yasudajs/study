# ユースケース・画面遷移図

## 1. ユースケース図

```
┌─────────────────────────────────────┐
│       九九練習アプリ               │
│                                     │
│  ┌──────────────────────────────┐  │
│  │                              │  │
│  │  UC1: 段を選択する           │  │
│  │  ├─ 1～9の段から選択         │  │
│  │  └─ 複数選択可能             │  │
│  │                              │  │
│  │  UC2: 出題方式を選択する     │  │
│  │  ├─ 順番出題を選択           │  │
│  │  └─ ランダム出題を選択       │  │
│  │                              │  │
│  │  UC3: 問題に回答する         │  │
│  │  ├─ 数値を入力               │  │
│  │  └─ 次の問題へ進む           │  │
│  │                              │  │
│  │  UC4: 正答率を確認する       │  │
│  │  ├─ 正答率をパーセンテージで表示 │
│  │  └─ 正解数/総問数を表示      │  │
│  │                              │  │
│  │  UC5: もう一度練習する       │  │
│  │  └─ 同じ段・方式で再実施     │  │
│  │                              │  │
│  │  UC6: スタートに戻る         │  │
│  │  └─ 段選択画面から開始       │  │
│  │                              │  │
│  └──────────────────────────────┘  │
│                                     │
│  [ユーザー（小学生）]                │
│                                     │
└─────────────────────────────────────┘
```

---

## 2. 詳細なユースケース記述

### UC1: 段を選択する

| 属性 | 内容 |
|------|------|
| **ユースケース名** | 段を選択する |
| **アクター** | ユーザー（小学生） |
| **前提条件** | スタート画面が表示されている |
| **主系列** | 1. ユーザーが段選択画面で学習したい段をチェックする<br>2. システムがチェック状態を記録する<br>3. ユーザーが「OK」ボタンをクリック<br>4. システムが選択段を保存し、出題方式選択画面へ遷移 |
| **例外系** | 1段も選択されていない場合、OKボタンは無効化される |
| **事後条件** | 選択した段が次画面で参照できる状態になる |

### UC2: 出題方式を選択する

| 属性 | 内容 |
|------|------|
| **ユースケース名** | 出題方式を選択する |
| **アクター** | ユーザー（小学生） |
| **前提条件** | 段選択が完了し、出題方式選択画面が表示されている |
| **主系列** | 1. ユーザーが「順番出題」または「ランダム出題」を選択<br>2. システムが選択を記録<br>3. ユーザーが「OK」ボタンをクリック<br>4. システムが問題リストを生成し、出題画面へ遷移 |
| **例外系** | なし（ラジオボタンは常に1つ選択状態） |
| **事後条件** | 選択された出題方式で問題が生成される |

### UC3: 問題に回答する

| 属性 | 内容 |
|------|------|
| **ユースケース名** | 問題に回答する |
| **アクター** | ユーザー（小学生） |
| **前提条件** | 出題画面が表示されており、現在の問題が見えている |
| **主系列** | 1. ユーザーが九九問題（a × b = ?）を見る<br>2. ユーザーが答えを入力欄に入力<br>3. ユーザーが「次へ」ボタンをクリック<br>4. システムが回答を記録し、正誤判定を実施<br>5. 残り問題があれば次問を表示、なければ結果画面へ遷移 |
| **例外系** | 入力がない場合、「次へ」ボタンは無効化<br>非数値が入力された場合、フィルタリング |
| **事後条件** | 回答が記録され、採点される |

### UC4: 正答率を確認する

| 属性 | 内容 |
|------|------|
| **ユースケース名** | 正答率を確認する |
| **アクター** | ユーザー（小学生） |
| **前提条件** | すべての問題への回答が完了している |
| **主系列** | 1. システムが正答率を計算<br>2. 結果画面に正答率（%）と正解数を表示<br>3. ユーザーが結果を確認 |
| **例外系** | なし |
| **事後条件** | 正答率が画面に表示されている |

### UC5: もう一度練習する

| 属性 | 内容 |
|------|------|
| **ユースケース名** | もう一度練習する |
| **アクター** | ユーザー（小学生） |
| **前提条件** | 正答率表示画面が表示されている |
| **主系列** | 1. ユーザーが「もう一度同じ練習」ボタンをクリック<br>2. システムが問題リストをリセット<br>3. システムが出題画面へ遷移<br>4. 同じ段・同じ方式で新たに問題を出題開始 |
| **例外系** | なし |
| **事後条件** | 出題画面で新たに回答を入力できる |

### UC6: スタートに戻る

| 属性 | 内容 |
|------|------|
| **ユースケース名** | スタートに戻る |
| **アクター** | ユーザー（小学生） |
| **前提条件** | 正答率表示画面が表示されている |
| **主系列** | 1. ユーザーが「最初に戻る」ボタンをクリック<br>2. システムがすべてのセッションデータをリセット<br>3. システムがスタート画面へ遷移 |
| **例外系** | なし |
| **事後条件** | スタート画面が表示され、新たな練習を開始可能 |

---

## 3. 詳細フロー図（シーケンス図）

### 全体フロー

```
ユーザー                   システム
   │                        │
   │ 1. さっそく始める！     │
   ├───────────────────────>│
   │                        │ スタート画面表示
   │                        │
   │ 2. 段を選択             │
   ├───────────────────────>│
   │                        │ 選択段を記録
   │                        │ OKボタン有効化
   │                        │
   │ 3. OKクリック           │
   ├───────────────────────>│
   │                        │ 段選択を保存
   │<───────────────────────┤
   │ 出題方式選択画面        │
   │                        │
   │ 4. 出題方式を選択       │
   ├───────────────────────>│
   │                        │ 選択を記録
   │                        │
   │ 5. OKクリック           │
   ├───────────────────────>│
   │                        │ 問題リスト生成
   │                        │ （順番 or ランダム）
   │<───────────────────────┤
   │ 出題画面                │
   │                        │
   │ 6. 問題を見る           │
   │                        │ 第1問を表示
   │                        │
   │ 7. 答えを入力           │
   ├───────────────────────>│
   │                        │
   │ 8. 次へクリック         │
   ├───────────────────────>│
   │                        │ 正誤判定実行
   │                        │ 正答数カウント
   │                        │
   │ [繰り返し: 問題数ぶん]   │
   │ 6-8 のフロー            │
   │                        │
   │                        │ 全問完了判定
   │<───────────────────────┤
   │ 正答率表示画面          │
   │                        │ 正答率計算
   │ 正答率と正解数を確認    │ 結果画面表示
   │                        │
   │ 9a. もう一度 OR         │
   │ 9b. 最初に戻る          │
   ├───────────────────────>│
   │                        │
   │ [9a の場合]            │
   │<───────────────────────┤
   │ 出題画面（リセット）    │
   │ → フロー6以降を繰り返す  │
   │                        │
   │ [9b の場合]            │
   │<───────────────────────┤
   │ スタート画面            │
   │ → フロー1から開始可能   │
   │                        │

```

---

## 4. 状態遷移図

```
                    [START]
                      ↓
              ╔═════════════════╗
              ║  スタート画面    ║
              ╚═════════════════╝
                      ↓
             [さっそく始める！]
                      ↓
              ╔═════════════════╗
              ║  段選択画面      ║
              ║  state: "level"  ║
              ╚═════════════════╝
                      ↓
                [OK (検証OK)]
                      ↓
              ╔═════════════════╗
              ║ 出題方式選択画面  ║
              ║ state: "mode"   ║
              ╚═════════════════╝
                      ↓
            [出題方式選択 + OK]
            (問題リスト生成)
                      ↓
              ╔═════════════════╗
              ║   出題画面       ║
              ║  state: "quiz"   ║
              ║ (currentQuizIndex)
              ╚═════════════════╝
                      ↓
            [回答入力 → 次へ]
                      ↓
              ┌─ 採点 ─┐
              │ 正答数++ │
              └────────┘
                      ↓
          ┌──────────────────────┐
          │ currentQuizIndex++    │
          │ < quizList.length ?   │
          └──────────────────────┘
               ↙         ↘
             YES         NO
              ↓           ↓
            出題画面      ╔═════════════════╗
           (次問へ)      ║   結果画面       ║
                         ║ state: "result"  ║
                         ║ (正答率計算)     ║
                         ╚═════════════════╝
                              ↓
                    ┌──────────┴──────────┐
                    │                     │
              [最初に戻る]        [もう一度]
                    │                     │
                    ↓                     ↓
              ╔═════════════╗      [quizList
              ║ 段選択画面   ║       リセット]
              ║(状態リセット) ║           ↓
              ╚═════════════╝       出題画面
                    ↓
              スタート画面へ
              (新規練習開始)
```

---

## 5. 画面遷移マトリックス

| 現在の画面 | アクション | 遷移先 | 状態変化 |
|----------|-----------|--------|---------|
| スタート | さっそく始める！ | 段選択 | currentScreen = "level" |
| 段選択 | OK | 出題方式選択 | selectedLevels を保存、currentScreen = "mode" |
| 段選択 | リセット | 段選択 | selectedLevels = []、OKボタン無効化 |
| 出題方式選択 | OK | 出題画面 | quizMode を保存、quizList 生成、currentScreen = "quiz" |
| 出題方式選択 | 戻る | 段選択 | quizMode リセット |
| 出題画面 | 次へ | 出題画面 OR 結果 | currentQuizIndex++、採点実施 |
| 出題画面 | 戻る | 出題方式選択 | 確認ダイアログ表示後、全データリセット |
| 結果 | もう一度 | 出題画面 | quizList リセット、currentQuizIndex = 0 |
| 結果 | 最初に戻る | スタート | 全状態リセット |

---

## 6. データフロー図

```
Input:                  Processing:              Output:
┌────────────┐          ┌──────────────┐        ┌────────────┐
│  段選択    │ ────────>│  段リスト     │───────>│  問題リスト │
│ (1,3,5等)  │          │  作成        │        │ (問題×9回) │
└────────────┘          └──────────────┘        └────────────┘

┌────────────┐          ┌──────────────┐        ┌────────────┐
│ 出題方式   │ ────────>│  シャッフル   │───────>│  順序付き  │
│ (順/ランダ)│          │  (必要時)    │        │  問題リスト │
└────────────┘          └──────────────┘        └────────────┘

┌────────────┐          ┌──────────────┐        ┌────────────┐
│ ユーザー   │ ────────>│  採点        │───────>│  ○/×判定  │
│ 回答       │          │  (compare)   │        │ 正答数     │
└────────────┘          └──────────────┘        └────────────┘

┌────────────┐          ┌──────────────┐        ┌────────────┐
│ 正答数     │ ────────>│  計算        │───────>│ 正答率(%)  │
│ 総問数     │          │  rate=(A/T)×100        │           │
└────────────┘          └──────────────┘        └────────────┘
```

---

## 7. エラーハンドリングフロー

```
┌─────────────────────────┐
│   入力検証エラー         │
│                         │
│  1段も選択されていない   │
│  ↓                      │
│  OKボタン無効化         │
│  エラーメッセージ表示    │
│  ↓                      │
│  ユーザー再入力         │
└─────────────────────────┘

┌─────────────────────────┐
│   入力フォーマットエラー  │
│                         │
│  非数値が入力された      │
│  ↓                      │
│  フィルタリング実行      │
│  または無視             │
│  ↓                      │
│  数値のみを受け入れ      │
└─────────────────────────┘

┌─────────────────────────┐
│   ページ離脱警告         │
│                         │
│  出題画面で戻るをクリック│
│  ↓                      │
│  確認ダイアログ表示      │
│  「本当に中止しますか？」 │
│  ↓                      │
│  ユーザー確認             │
│  Yes → データ削除        │
│  No  → 出題画面続行      │
└─────────────────────────┘
```

---

## 8. ユーザージャーニーマップ

```
学習目標: 3の段を練習して、正答率80%以上を目指す

┌────────────────────────────────────────┐
│ 感情推移                                │
│  ↑ 楽しい                               │
│  │  ╭─────────────────────╮            │
│  │  │                     │            │
│  │──┤     アプリ起動       │            │
│  │  │                     │            │
│  │  ╰─┬─────────────────┬─╯            │
│  │    │                 │              │
│  │    段選択            出題開始       │
│  │    (3の段)            │              │
│  │    │                 │              │
│  │    ├─正答────────┬─正答            │
│  │    │ (楽しい)    │(達成感増加)     │
│  │    │            │                 │
│  │    ├─不正答────┬─正答            │
│  │    │(焦り)    │(回復)             │
│  │    │            │                 │
│  ├────┼────────────┴──────┤           │
│  │ つまらない              │           │
│  │                        └─結果表示 │
│  │                          (満足)   │
│  └────────────────────────────────────┘
     時間経過 →

フェーズ:
1. 準備フェーズ: 段選択、出題方式選択（期待と不安）
2. 実行フェーズ: 問題回答（集中・緊張）
3. 完了フェーズ: 結果表示（達成感・改善欲）
```

---

## 9. リカバリーシナリオ

### シナリオ1: ページをリロードした場合
**想定**: ユーザーが誤ってページをリロードしてしまった

**現在のフロー**:
- セッションデータが失われ、スタート画面に戻る（仕様通り）

**改善案（将来版）**:
- localStorage に現在の進捗を保存し、復帰可能にする

### シナリオ2: ブラウザのバックボタンを押した場合
**想定**: ユーザーが誤ってブラウザのバックボタンを押した

**現在のフロー**:
- アプリ独自のナビゲーション（戻るボタン）を使う仕様なので、予期しない遷移は発生しない

**推奨**: 履歴管理のため History API (pushState) を導入検討

### シナリオ3: インターネット接続が断絶した場合
**影響**: なし（バックエンド API なし、ローカルで完結するため）

---

## 10. 非ユースケース（スコープ外）

以下の操作はアプリで対応しません：

1. ユーザー登録・ログイン
2. 成績保存・履歴管理
3. 複数ユーザーの管理
4. 親・教師向け画面
5. オンラインランキング
6. SNS シェア機能
7. 広告表示
8. 課金機能
