{% extends 'base.html' %}

{% block title %}単漢字練習 - 漢字の読み練習アプリ{% endblock %}

{% block description %}小学生向け漢字の読み練習アプリ。学年別に漢字を練習できます。{% endblock %}

{% block content %}
<div class="tankanji-app">
    <header class="app-header">
        <a href="/" class="back-button">← 戻る</a>
        <h1>単漢字練習</h1>
    </header>

    <main class="app-main">
      <!-- 設定画面 -->
      <div id="settingScreen" class="screen active">
    
        <h2>学年と出題の順序を選択</h2>

        <!-- 学年選択 -->
        <section class="panel">
          <h3>学年を選択してください</h3>
          <select id="gradeSelect">
            <option value="">-- 選択してください --</option>
            <option value="1">1年生</option>
            <option value="2">2年生</option>
            <option value="3">3年生</option>
            <option value="4">4年生</option>
            <option value="5">5年生</option>
            <option value="6">6年生</option>
          </select>
        </section>

        <!-- 順序選択（学年選択後に表示） -->
        <section id="orderSection" class="panel" style="display: none;">
          <h3>出題の順序を選択してください</h3>
          <div class="button-group">
            <button id="strokeOrderBtn" class="option-btn" data-order="stroke">画数の少ない順</button>
            <button id="randomOrderBtn" class="option-btn" data-order="random">ランダム</button>
          </div>
        </section>

        <!-- 開始ボタン（順序選択後に表示） -->
        <div id="startSection" class="start-row" style="display: none;">
          <button id="startBtn" class="start-btn">出題を開始する</button>
        </div>
      </div>

    <!-- 出題画面 -->
    <div id="quizScreen" class="screen">
      <div class="quiz-meta"><span id="currentQuestion">1問目</span></div>
      <div class="quiz-content-wrapper">
        <!-- 読み練習 -->
        <div id="readQuiz" class="quiz-content" style="display: none;">
          <div class="kanji-display">
            <div id="quizKanji" class="kanji-large">漢</div>
          </div>
          <div id="strokeCount" class="stroke-count">画数：-</div>
          <p class="instruction">漢字と読みをノートに書いて書き取り練習しよう。</p>
          <div id="answerDisplay" class="answer-display" style="display: block;">
            <div class="reading-list">
              <div id="onReading" class="reading-item"></div>
              <div id="onReadingHint" class="reading-hint"></div>
              <div id="kunReading" class="reading-item"></div>
              <div id="kunReadingHint" class="reading-hint"></div>
            </div>
          </div>
          <div class="action-row">
            <button id="showAnswerBtn" class="action-btn">答え</button>
            <button id="nextQuizBtn" class="action-btn next-btn" style="display: none;">次へ</button>
          </div>
        </div>

      </div>
    </div>

  <!-- 学習履歴画面 -->
  <div id="historyScreen" class="screen">
    <div class="history-header">
      <h2>学習履歴</h2>
      <button id="backToSettingFromHistoryBtn" class="back-btn">戻る</button>
    </div>
    <div id="historyContent" class="history-content">
      <p>学習履歴がありません</p>
    </div>
  </div>

  <!-- 10問完了画面 -->
  <div id="completionScreen" class="screen">
    <div class="completion-content">
      <h2>お疲れ様でした！</h2>
      <p id="completionMessage">10問を出題しました</p>
      <div id="completedKanjis" class="completed-list"></div>
      <div class="completion-buttons">
        <button id="restartBtn" class="action-btn">もう一度練習する</button>
        <button id="goToHistoryBtn" class="action-btn secondary-btn">学習履歴を見る</button>
        <button id="backToSettingFromCompletionBtn" class="back-btn">設定に戻る</button>
      </div>
    </div>
  </div>
    </main>
</div>

<style>
  .tankanji-app {
    display: flex;
    flex-direction: column;
    min-height: 100vh;
    background: white;
    width: 100%;
  }

  .app-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    padding: 20px;
    text-align: center;
    position: relative;
  }

  .app-header h1 {
    margin: 0;
    font-size: 28px;
  }

  .back-button {
    position: absolute;
    left: 20px;
    top: 50%;
    transform: translateY(-50%);
    color: white;
    text-decoration: none;
    font-size: 16px;
    padding: 8px 12px;
  }

  .app-main {
    flex: 1;
    overflow-y: auto;
    padding: 20px;
    max-width: 600px;
    margin: 0 auto;
    width: 100%;
  }

  .screen {
    display: none;
  }

  .screen.active {
    display: block;
  }

  h2 {
    text-align: center;
    color: #333;
    margin-bottom: 30px;
  }

  h3 {
    margin: 0 0 10px;
    color: #333;
  }

  .panel {
    background: #f8f9fa;
    padding: 16px;
    border-radius: 12px;
    margin-bottom: 16px;
    border: 1px solid #e5e7eb;
  }

  .setting-section {
    margin: 20px 0;
  }

  #gradeSelect {
    width: 100%;
    padding: 10px;
    font-size: 1rem;
    border: 2px solid #007bff;
    border-radius: 5px;
  }

  .button-group {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
  }

  .option-btn {
    flex: 1;
    min-width: 120px;
    padding: 14px;
    font-size: 1rem;
    background-color: white;
    border: 2px solid #ddd;
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .option-btn:hover {
    border-color: #1d976c;
    background: #eefbf3;
  }

  .option-btn.selected {
    background-color: #1d976c;
    color: white;
    border-color: #1d976c;
  }

  .start-btn {
    width: auto;
    min-width: 180px;
    padding: 14px 20px;
    font-size: 1.1rem;
    background-color: #28a745;
    color: white;
    border: none;
    border-radius: 10px;
    cursor: pointer;
    transition: background-color 0.3s;
    font-weight: bold;
  }

  .start-btn:hover {
    background-color: #218838;
  }

  .next-btn {
    background-color: #28a745;
  }

  .next-btn:hover {
    background-color: #218838;
  }

  .start-row {
    display: flex;
    justify-content: flex-end;
    margin-top: 10px;
  }

  .quiz-header {
    display: flex;
    justify-content: flex-end;
    align-items: center;
    margin-bottom: 20px;
  }

  .back-btn {
    padding: 8px 12px;
    background-color: #6c757d;
    color: white;
    border: none;
    border-radius: 3px;
    cursor: pointer;
  }

  .back-btn:hover {
    background-color: #5a6268;
  }

  .kanji-display {
    text-align: center;
    margin: 30px 0;
  }

  .kanji-large,
  .kanji-large-write {
    font-size: 20rem;
    font-weight: bold;
    font-family: 'Hiragino Mincho ProN', 'Noto Serif JP', serif;
  }

  .quiz-meta {
    display: flex;
    justify-content: flex-start;
    align-items: center;
    margin-bottom: 10px;
    font-weight: bold;
    color: #555;
    font-size: 2rem;
  }

  .action-btn {
    width: auto;
    min-width: 140px;
    padding: 12px 20px;
    margin: 0;
    font-size: 1rem;
    background-color: #007bff;
    color: white;
    border: none;
    border-radius: 5px;
    text-align: center;
    display: inline-flex;
    justify-content: center;
    align-items: center;
    cursor: pointer;
    transition: background-color 0.3s;
  }

  .action-btn.next-btn {
    background-color: #28a745;
  }

  .action-btn.next-btn:hover {
    background-color: #218838;
  }

  .action-row {
    display: flex;
    justify-content: flex-end;
    margin: 20px 0 10px;
  }

  .action-btn:hover {
    background-color: #0056b3;
  }

  .secondary-btn {
    background-color: white;
    color: #007bff;
    border: 2px solid #007bff;
  }

  .secondary-btn:hover {
    background-color: #f0f7ff;
  }

  .answer-display {
    margin: 20px 0;
    padding: 15px;
    background-color: #f9f9f9;
    border-left: 4px solid #007bff;
    border-radius: 3px;
  }

  .reading-list {
    margin-bottom: 15px;
  }

  .reading-item {
    padding: 8px 0;
    font-size: 1.1rem;
  }

  #onReading::before {
    content: '音読み: ';
    font-weight: bold;
  }

  #kunReading::before {
    content: '訓読み: ';
    font-weight: bold;
  }

  #onReadingHint::before {
    content: '音読みヒント: ';
    font-weight: bold;
  }

  #kunReadingHint::before {
    content: '訓読みヒント: ';
    font-weight: bold;
  }

  .reading-hint {
    padding: 4px 0 12px 0;
    font-size: 0.95rem;
    color: #333;
    margin-left: 8px;
  }

  .instruction {
    text-align: center;
    font-size: 1.1rem;
    color: #666;
    margin: 20px 0;
  }

  .stroke-count {
    text-align: center;
    font-size: 2rem;
    color: #666;
    margin: 12px 0 0;
  }

  .completion-content {
    text-align: center;
  }

  .completed-list {
    margin: 20px 0;
    padding: 15px;
    background-color: #f9f9f9;
    border-radius: 5px;
  }

  .completion-buttons {
    display: flex;
    flex-direction: column;
    gap: 10px;
    margin-top: 20px;
    align-items: flex-end;
  }

  .completion-buttons button {
    min-width: 180px;
  }

  .history-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
  }

  .history-content {
    padding: 15px;
    background-color: #f9f9f9;
    border-radius: 5px;
  }

  @media (max-width: 600px) {
    .kanji-large,
    .kanji-large-write {
      font-size: 20rem;
    }

    .button-group {
      flex-direction: column;
    }

    .option-btn {
      min-width: auto;
    }
  }

    @media (max-width: 599px) {
      .app-header {
        padding: 15px;
      }
      .app-header h1 {
        font-size: 22px;
      }
      .app-main {
        padding: 15px;
      }

      /* 結果(10問完了)画面のボタンは、スマホでは画面幅いっぱいに揃える */
      #completionScreen .completion-buttons {
        align-items: stretch;
      }

      #completionScreen .completion-buttons button,
      #completionScreen .completion-buttons .action-btn,
      #completionScreen .completion-buttons .back-btn {
        width: 100%;
        min-width: 0;
      }
    }

    @media (min-width: 600px) {
      .tankanji-app {
        max-width: 600px;
        margin: 40px auto;
        box-shadow: 0 10px 40px rgba(0, 0, 0, 0.1);
        border-radius: 10px;
        height: auto;
        min-height: 90vh;
      }

      .app-main {
        padding: 40px;
      }
    }
</style>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/historyManager.js') }}"></script>
<script src="{{ url_for('static', filename='js/tankanjiBuddy.js') }}"></script>
{% endblock %}
